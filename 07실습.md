# ë°ì´í„°ë² ì´ìŠ¤ 07 - ORM

<aside>
ğŸ’¡ ì½”ë“œë¥¼ ì‘ì„±í•œ ì‹¤ìŠµ íŒŒì¼ì„ ì••ì¶•í•´ì„œ ì‹¤ë¼ë²„ìŠ¤ì— ì œì¶œí•´ì£¼ì„¸ìš”.

</aside>

### 1. `db/models.py` íŒŒì¼ì— ì•„ë˜ì˜ ëª¨ë¸ 2ê°œ `Director` `Genre` ë¥¼ ì‘ì„±í•˜ì„¸ìš”.

> ê¸°ë³¸ ì½”ë“œ
> 

```python
class Director(models.Model):
    name = models.TextField()
    debut = models.DateTimeField()
    country = models.TextField()

class Genre(models.Model):
    title = models.TextField()
```

### 2. ëª¨ë¸ì„ ë§ˆì´ê·¸ë ˆì´íŠ¸(migrate) í•˜ì„¸ìš”.

```bash
# ê°€ìƒí™˜ê²½ ì‹¤í–‰ í™•ì¸ í›„ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í„°ë¯¸ë„ì— ì…ë ¥í•©ë‹ˆë‹¤.
python manage.py makemigrations

python manage.py migrate
```

### 3. Queryset ë©”ì†Œë“œ `create` ë¥¼ í™œìš©í•´ì„œ  `Director` í…Œì´ë¸”ì— ì•„ë˜ ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”.

| name | debut | country |
| --- | --- | --- |
| ë´‰ì¤€í˜¸ | 1993-01-01 | KOR |
| ê¹€í•œë¯¼ | 1999-01-01 | KOR |
| ìµœë™í›ˆ | 2004-01-01 | KOR |
| ì´ì •ì¬ | 2022-01-01 | KOR |
| ì´ê²½ê·œ | 1992-01-01 | KOR |
| í•œì¬ë¦¼ | 2005-01-01 | KOR |
| Joseph Kosinski | 1999-01-01 | KOR |
| ê¹€ì² ìˆ˜ | 2022-01-01 | KOR |

> ì½”ë“œ ì‘ì„±
> 

```python
with open("db/prac3.txt", 'r', encoding="utf-8") as f:
    ...:     for line in f.readlines():
    ...:         l = line.strip('|').split('|')
    ...:
    ...:         # ì•ˆë¨
    ...:         #for word in l:
    ...:         #    word = word.strip()
    ...:
    ...:         Director.objects.create(name=l[0].strip(), debut=l[1].strip(), country=l[2].strip())
```

```
id	name	debut	country
9	ë´‰ì¤€í˜¸	1993-01-01 00:00:00	KOR
10	ê¹€í•œë¯¼	1999-01-01 00:00:00	KOR
11	ìµœë™í›ˆ	2004-01-01 00:00:00	KOR
12	ì´ì •ì¬	2022-01-01 00:00:00	KOR
13	ì´ê²½ê·œ	1992-01-01 00:00:00	KOR
14	í•œì¬ë¦¼	2005-01-01 00:00:00	KOR
15	Joseph Kosinski	1999-01-01 00:00:00	KOR
16	ê¹€ì² ìˆ˜	2022-01-01 00:00:00	KOR
```

### 4. `ì¸ìŠ¤í„´ìŠ¤ ì¡°ì‘` ì„ í™œìš©í•˜ì—¬`Genre` í…Œì´ë¸”ì— ì•„ë˜ ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”.

| title |
| --- |
| ì•¡ì…˜ |
| ë“œë¼ë§ˆ |
| ì‚¬ê·¹ |
| ë²”ì£„ |
| ìŠ¤ë¦´ëŸ¬ |
| SF |
| ë¬´í˜‘ |
| ì²©ë³´ |
| ì¬ë‚œ |

> ì½”ë“œ ì‘ì„±
> 

```python
with open("db/prac4.txt", 'r', encoding="utf-8") as f:
   ...:     for line in f.readlines():
   ...:         l = line.strip('|').strip()
   ...:         l = l.strip('|')
   ...:         genre = Genre()
   ...:         genre.title = l
   ...:         genre.save()
```

```
id	title
1	ì•¡ì…˜   
2	ë“œë¼ë§ˆ 
3	ì‚¬ê·¹   
4	ë²”ì£„   
5	ìŠ¤ë¦´ëŸ¬ 
6	SF     
7	ë¬´í˜‘   
8	ì²©ë³´   
9	ì¬ë‚œ
```

### 5. Queryset ë©”ì†Œë“œ `all` ì„ í™œìš©í•´ì„œ `Director` í…Œì´ë¸”ì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ì¶œë ¥í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”.

> ì¶œë ¥ ì˜ˆì‹œ
> 

```
ë´‰ì¤€í˜¸ 1993-01-01 00:00:00 KOR
ê¹€í•œë¯¼ 1999-01-01 00:00:00 KOR
ìµœë™í›ˆ 2004-01-01 00:00:00 KOR
ì´ì •ì¬ 2022-01-01 00:00:00 KOR
ì´ê²½ê·œ 1992-01-01 00:00:00 KOR
í•œì¬ë¦¼ 2005-01-01 00:00:00 KOR
Joseph Kosinski 1999-01-01 00:00:00 KOR
ê¹€ì² ìˆ˜ 2022-01-01 00:00:00 KOR
```

> ì½”ë“œ ì‘ì„±
> 

```python
# ì•„ë˜ëŠ” models.py
class Director(models.Model):
    name = models.TextField()
    debut = models.DateTimeField(null=True)
    country = models.TextField()

    def print(self):
        print(self.name, self.debut, self.country)
...

# ì•„ë˜ëŠ” ì‰˜
In [11]: for obj in Director.objects.all():
    ...:     # Director ê°ì²´ëŠ” iterable í•˜ì§€ ëª»í•´ì„œ ìˆœíšŒ ë¶ˆê°€ëŠ¥
    ...:     obj.print()
```

```
ë´‰ì¤€í˜¸ 1993-01-01 00:00:00 KOR
ê¹€í•œë¯¼ 1999-01-01 00:00:00 KOR
ìµœë™í›ˆ 2004-01-01 00:00:00 KOR
ì´ì •ì¬ 2022-01-01 00:00:00 KOR
ì´ê²½ê·œ 1992-01-01 00:00:00 KOR
í•œì¬ë¦¼ 2005-01-01 00:00:00 KOR
Joseph Kosinski 1999-01-01 00:00:00 KOR
ê¹€ì² ìˆ˜ 2022-01-01 00:00:00 KOR
```

### 6. Queryset ë©”ì†Œë“œ `get` ì„ í™œìš©í•´ì„œ `Director` í…Œì´ë¸”ì—ì„œ `id` ê°€ 1ì¸ ë°ì´í„°ë¥¼ ì¶œë ¥í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”.

> ì¶œë ¥ ì˜ˆì‹œ
> 

```
ë´‰ì¤€í˜¸ 1993-01-01 00:00:00 KOR
```

> ì½”ë“œ ì‘ì„±
> 

```python
# ì•„ë˜ëŠ” models.py
class Director(models.Model):
    name = models.TextField()
    debut = models.DateTimeField(null=True)
    country = models.TextField()

    def print(self):
        print(self.name, self.debut, self.country)
...

# ì•„ë˜ëŠ” ì‰˜
# ì—°ìŠµí•œë‹¤ê³  ì´ì „ ê°’ë“¤ì„ ì‚­ì œí•´ì„œ id ê°’ì´ 9ë¶€í„° ì‹œì‘í•¨.
In [1]: obj = Director.objects.get(id=9)
In [2]: obj.print()
```

```
ë´‰ì¤€í˜¸ 1993-01-01 00:00:00 KOR
```

### 7. Queryset ë©”ì†Œë“œ `get` ì„ í™œìš©í•´ì„œ `Director` í…Œì´ë¸”ì—ì„œ `country` ê°€ USAì¸ ë°ì´í„°ë¥¼ ì¶œë ¥í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”.

> ì½”ë“œ ì‘ì„±
> 

```python
# ì˜¤ë¥˜ ë°œìƒ
obj = Director.objects.get(country="USA")
obj.print()
```

### 8. ìœ„ ë¬¸ì œì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤. ì¶œë ¥ëœ ì˜¤ë¥˜ ë©”ì„¸ì§€ì™€ ë³¸ì¸ì´ ìƒê°í•˜ëŠ” í˜¹ì€ ì°¾ì€ ì˜¤ë¥˜ê°€ ë°œìƒí•œ ì´ìœ ë¥¼ ì‘ì„±í•˜ì„¸ìš”.

> ì˜¤ë¥˜ ë©”ì„¸ì§€
> 

```bash
DoesNotExist                              Traceback (most recent call last)
Input In [3], in <cell line: 1>()
----> 1 obj = Director.objects.get(country="USA")

File ~\Desktop\multicampus\DB\DB-ORM\venv\lib\site-packages\django\db\models\manager.py:85, in BaseManager._get_queryset_methods.<locals>.create_method.<locals>.manager_method(self, *args, **kwargs)
     84 def manager_method(self, *args, **kwargs):
---> 85     return getattr(self.get_queryset(), name)(*args, **kwargs)

File ~\Desktop\multicampus\DB\DB-ORM\venv\lib\site-packages\django\db\models\query.py:496, in QuerySet.get(self, *args, **kwargs)
    494     return clone._result_cache[0]
    495 if not num:
--> 496     raise self.model.DoesNotExist(
    497         "%s matching query does not exist." % self.model._meta.object_name
    498     )
    499 raise self.model.MultipleObjectsReturned(
    500     "get() returned more than one %s -- it returned %s!"
    501     % (
   (...)
    504     )
    505 )

DoesNotExist: Director matching query does not exist.
```

> ì´ìœ  ì‘ì„±
> 

```
ì—ëŸ¬ ë©”ì‹œì§€ ì²˜ìŒì— ë‚˜ì˜¨ ê²ƒì²˜ëŸ¼ í•´ë‹¹ ê°’ì˜ ë ˆì½”ë“œê°€ ì—†ê¸° ë•Œë¬¸ì— ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚¨ë‹¤. í´ë˜ìŠ¤ëª….objects.get(í•„ë“œ='ì°¾ê³ ì í•˜ëŠ” ê°’') ì¸ í´ë˜ìŠ¤ ë©”ì†Œë“œ get ì€ ì°¾ê³ ì í•˜ëŠ” ê°’ì´ ì—†ê±°ë‚˜ 1ê°œë³´ë‹¤ ë§ìœ¼ë©´ ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚¨ë‹¤.
```

### 9. Queryset ë©”ì†Œë“œ `get` ê³¼ `save` ë¥¼ í™œìš©í•´ì„œ `Director` í…Œì´ë¸”ì—ì„œ  `name` ì´ Joseph Kosinskiì¸ ë°ì´í„°ë¥¼ ì¡°íšŒí•´ì„œ `country` ë¥¼ USA ë¡œ ìˆ˜ì •í•˜ê³ , ì¶œë ¥í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”.

> ì¶œë ¥ ì˜ˆì‹œ
> 

```
Joseph Kosinski 1999-01-01 00:00:00 USA
```

> ì½”ë“œ ì‘ì„±
> 

```python
# ì•„ë˜ëŠ” models.py
class Director(models.Model):
    name = models.TextField()
    debut = models.DateTimeField(null=True)
    country = models.TextField()

    def print(self):
        print(self.name, self.debut, self.country)
...

# ì•„ë˜ëŠ” ì‰˜
In [5]: obj = Director.objects.get(name="Joseph Kosinski")
In [6]: obj.country = "USA"
In [7]: obj.save()
In [8]: obj.print()
```

```
Joseph Kosinski 1999-01-01 00:00:00 USA
```

### 10. Queryset ë©”ì†Œë“œ `get` ì„ í™œìš©í•´ì„œ `Director` í…Œì´ë¸”ì—ì„œ `country` ê°€ KORì¸ ë°ì´í„°ë¥¼ ì¶œë ¥í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”.

> ì½”ë“œ ì‘ì„±
> 

```python
In [9]: for obj in Director.objects.filter(country="KOR"):
   ...:     obj.print()
```

```
ë´‰ì¤€í˜¸ 1993-01-01 00:00:00 KOR
ê¹€í•œë¯¼ 1999-01-01 00:00:00 KOR
ìµœë™í›ˆ 2004-01-01 00:00:00 KOR
ì´ì •ì¬ 2022-01-01 00:00:00 KOR
ì´ê²½ê·œ 1992-01-01 00:00:00 KOR
í•œì¬ë¦¼ 2005-01-01 00:00:00 KOR
ê¹€ì² ìˆ˜ 2022-01-01 00:00:00 KOR
```

### 11. ìœ„ ë¬¸ì œì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤. ì¶œë ¥ëœ ì˜¤ë¥˜ ë©”ì„¸ì§€ì™€ ë³¸ì¸ì´ ìƒê°í•˜ëŠ” í˜¹ì€ ì°¾ì€ ì˜¤ë¥˜ê°€ ë°œìƒí•œ ì´ìœ ë¥¼ ì‘ì„±í•˜ì„¸ìš”.

> ì˜¤ë¥˜ ë©”ì„¸ì§€
> 

```bash
MultipleObjectsReturned                   Traceback (most recent call last)
Input In [10], in <cell line: 1>()
----> 1 for obj in Director.objects.get(country="KOR"):
      2     obj.print()

File ~\Desktop\multicampus\DB\DB-ORM\venv\lib\site-packages\django\db\models\manager.py:85, in BaseManager._get_queryset_methods.<locals>.create_method.<locals>.manager_method(self, *args, **kwargs)
     84 def manager_method(self, *args, **kwargs):
---> 85     return getattr(self.get_queryset(), name)(*args, **kwargs)

File ~\Desktop\multicampus\DB\DB-ORM\venv\lib\site-packages\django\db\models\query.py:499, in QuerySet.get(self, *args, **kwargs)
    495 if not num:
    496     raise self.model.DoesNotExist(
    497         "%s matching query does not exist." % self.model._meta.object_name
    498     )
--> 499 raise self.model.MultipleObjectsReturned(
    500     "get() returned more than one %s -- it returned %s!"
    501     % (
    502         self.model._meta.object_name,
    503         num if not limit or num < limit else "more than %s" % (limit - 1),
    504     )
    505 )

MultipleObjectsReturned: get() returned more than one Director -- it returned 7!
```

> ì´ìœ  ì‘ì„±
> 

```
8ë²ˆ ë¬¸ì œì—ì„œë„ ì–¸ê¸‰í–ˆë“¯ get ë©”ì†Œë“œëŠ” ì°¾ê³ ì í•˜ëŠ” ê°’ì˜ ë ˆì½”ë“œê°€ ì—†ê±°ë‚˜ 2ê°œ ì´ìƒì´ë©´ ì—ëŸ¬ ë©”ì„¸ì§€ë¥¼ ì¶œë ¥í•œë‹¤.
```

### 12. Queryset ë©”ì†Œë“œ `filter` ë¥¼ í™œìš©í•´ì„œ `Director` í…Œì´ë¸”ì—ì„œ `country` ê°€ KORì¸ ë°ì´í„°ë¥¼ ì¶œë ¥í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”.

> ì¶œë ¥ ì˜ˆì‹œ
> 

```
ë´‰ì¤€í˜¸ 1993-01-01 00:00:00 KOR
ê¹€í•œë¯¼ 1999-01-01 00:00:00 KOR
ìµœë™í›ˆ 2004-01-01 00:00:00 KOR
ì´ì •ì¬ 2022-01-01 00:00:00 KOR
ì´ê²½ê·œ 1992-01-01 00:00:00 KOR
í•œì¬ë¦¼ 2005-01-01 00:00:00 KOR
ê¹€ì² ìˆ˜ 2022-01-01 00:00:00 KOR
```

> ì½”ë“œ ì‘ì„±
> 

```python
In [11]: for obj in Director.objects.filter(country="KOR"):
    ...:     obj.print()
```

```
ë´‰ì¤€í˜¸ 1993-01-01 00:00:00 KOR
ê¹€í•œë¯¼ 1999-01-01 00:00:00 KOR
ìµœë™í›ˆ 2004-01-01 00:00:00 KOR
ì´ì •ì¬ 2022-01-01 00:00:00 KOR
ì´ê²½ê·œ 1992-01-01 00:00:00 KOR
í•œì¬ë¦¼ 2005-01-01 00:00:00 KOR
ê¹€ì² ìˆ˜ 2022-01-01 00:00:00 KOR
```

### 13. ë³¸ì¸ì´ ìƒê°í•˜ëŠ” í˜¹ì€ ì°¾ì€ `get` ê³¼ `filter` ì˜ ì°¨ì´ë¥¼ ì‘ì„±í•˜ì„¸ìš”.

```
get : 1ê°œê°€ ì•„ë‹ˆë©´ ì˜¤ë¥˜ë¥¼ ì¶œë ¥, 1ê°œë©´ í•´ë‹¹ ë ˆì½”ë“œë¥¼ íŒŒì´ì¬ì˜ ê°ì²´ë¡œì¨ ê°€ì ¸ì˜¨ë‹¤.
filter : ì¼ë¶€ ë˜ëŠ” ì „ì²´ ë ˆì½”ë“œë¥¼ íŒŒì´ì¬ ê°ì²´ë¡œì¨ ê°€ì ¸ì˜¨ë‹¤.
```

### 14. Queryset ë©”ì†Œë“œ `get` ê³¼ `delete`ë¥¼ í™œìš©í•´ì„œ  `Director` í…Œì´ë¸”ì—ì„œ `name` ì´ ê¹€ì² ìˆ˜ì¸ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”.

> ì½”ë“œ ì‘ì„±
> 

```python
In [12]: Director.objects.get(name="ê¹€ì² ìˆ˜").delete()
```

```
Out[12]: (1, {'db.Director': 1})

In [13]: for obj in Director.objects.all():
    ...:     obj.print()
    ...:
ë´‰ì¤€í˜¸ 1993-01-01 00:00:00 KOR
ê¹€í•œë¯¼ 1999-01-01 00:00:00 KOR
ìµœë™í›ˆ 2004-01-01 00:00:00 KOR
ì´ì •ì¬ 2022-01-01 00:00:00 KOR
ì´ê²½ê·œ 1992-01-01 00:00:00 KOR
í•œì¬ë¦¼ 2005-01-01 00:00:00 KOR
Joseph Kosinski 1999-01-01 00:00:00 USA
```